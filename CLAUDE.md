# CLAUDE.md

このファイルは、このリポジトリで作業する際にClaude Code (claude.ai/code) への指針を提供します。

## プロジェクト概要

AlligatorGar は、Ubuntu/Linux での開発とGitHub Actions による自動Windows実行ファイル生成を特徴とする、Windows環境向けの強力な多機能自動化ツールです。Python初心者向けに設計されていますが、本格運用可能な自動化ツールを生成します。

**現在の中核機能**: ZIPファイルを監視し、日付スタンプを追加し、B5 2面付けレイアウトに変換し、自動印刷を処理するPDF処理自動化システム

**将来のビジョン**: 様々な便利な自動化機能のための拡張可能なプラットフォーム

## アーキテクチャ

### 2層アプリケーション構造
- **GUI版** (`gui_main.py`): リアルタイムステータス、設定管理、ユーザーフレンドリーな操作を備えたtkinterベースのグラフィカルインターフェース
- **Console版** (`process_enhanced.py`): JSON設定によるサーバーデプロイメント最適化されたコマンドライン版

### 中核処理パイプライン
```
ZIP監視 → PDF抽出 → スタンプ追加 → B5 2面付けレイアウト → 印刷/保存 → クリーンアップ
```

### 主要なアーキテクチャコンポーネント
1. **設定管理**: 自動生成と階層設定マージ機能を備えたJSONベース設定
2. **PDF処理パイプライン**: 操作にPyMuPDF、スタンプ作成にPIL、レイアウトにReportLabを使用
3. **ファイルライフサイクル管理**: 設定可能な保持期間による自動クリーンアップ
4. **ログシステム**: 複数レベルとエラー追跡機能を備えたローテーティングログ
5. **マルチスレッド**: GUIは応答性を維持するためにバックグラウンドスレッドで処理を実行

## 開発環境

### セットアップコマンド
```bash
# 環境初期化
./setup-ubuntu.sh
source venv/bin/activate

# 開発ワークフロー
python test_basic.py          # 基本機能テスト
python gui_main.py            # GUI版実行
python process_enhanced.py    # Console版実行
```

### ビルドとデプロイ
```bash
# ローカル開発
source venv/bin/activate
pip install -r requirements-simple.txt

# 自動Windows ビルド (pushで実行)
git push  # GitHub Actionsトリガー → AlligatorGar_GUI.exe + AlligatorGar_Console.exe 生成
```

### テスト戦略
- `test_basic.py`: 中核機能とライブラリ互換性
- `test_compatibility.py`: システムと環境検証
- `test_pdf_basic.py`: PDF処理パイプライン検証
- `test_network.py`: UNCパスとネットワーク共有テスト

## 技術仕様

### プラットフォーム互換性
- **開発環境**: Python 3.7+のUbuntu/Linux
- **対象環境**: Windows 10/11 (レガシーシステム用32bit互換)
- **依存関係**: PyMuPDF==1.21.1, Pillow==8.4.0, reportlab==3.6.0, pyinstaller==5.13.2

### 処理能力
- **入力**: 複数のPDFを含むZIPファイル
- **スタンプシステム**: 日本語フォントサポート (msgothic.ttc) による動的日付スタンプ
- **レイアウトエンジン**: B5 2面付け変換 (ページあたり595x842ポイント)
- **出力**: ネットワーク共有PDF保存 + Windows印刷統合

### 設定システム
アプリケーションは階層JSONベース設定システムを使用:
- コードに埋め込まれたデフォルト設定
- `config.json` でのユーザーオーバーライド (初回実行時自動生成)
- GUIでのリアルタイム設定編集機能
- Console版では手動JSON編集が必要

## 主要な開発パターン

### エラーハンドリング思想
- 詳細ログによる段階的劣化
- ネットワーク操作のリトライメカニズム (最大3回、5秒遅延)
- GUIでのユーザーフレンドリーエラーメッセージ、ログでの技術詳細

### ファイル管理戦略
- 入出力用のネットワークパス (UNC)
- 自動クリーンアップ付きローカル一時処理
- 中間ファイルの設定可能な保持期間
- 操作前のパス検証と存在確認

### GUI開発アプローチ
- タブベースインターフェース (制御、設定、ログ、情報)
- スレッドによるリアルタイムステータス更新
- 設定検証と即座のフィードバック
- 自動スクロールと検索機能付きログ表示

## GitHub Actions統合

プロジェクトは自動Windows実行ファイル生成を使用:
- **トリガー**: main/masterへのpushまたは手動ワークフロー実行
- **出力**: 2つの実行ファイル (GUI + Console版)
- **依存関係**: Windows 10 32bit互換性のためのPython 3.7.9 x86
- **パッケージング**: stamp.svg含む、READMEファイル付き配布パッケージ生成

## アプリケーションの拡張

新しい自動化機能を追加する際:
1. 既存のGUIとConsoleの分離実装パターンに従う
2. `process_enhanced.py` のデフォルト設定に設定オプションを追加
3. ユーザー向けコントロールのために `gui_main.py` のGUIタブを更新
4. `test_*.py` ファイルで適切なテストカバレッジを追加
5. 新しい依存関係が必要な場合はGitHub Actionsワークフローを更新

アーキテクチャは、初心者向けの開発体験と本格的なデプロイメント能力を維持しながら、様々な自動化タスクに対応するように設計されています。